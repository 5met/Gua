<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜“ç»ç®—å¦</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'PingFang SC', sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* 64å¦èƒŒæ™¯ */
        .hexagram-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            opacity: 0.25;
            pointer-events: none;
            overflow: hidden;
        }

        .hexagram-item {
            position: absolute;
            font-size: 32px;
            color: #667eea;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .hexagram-item.flashing {
            animation: flash 0.5s infinite alternate;
            opacity: 0.8;
        }

        @keyframes flash {
            0% { opacity: 0.3; transform: scale(1); }
            100% { opacity: 1; transform: scale(1.3); }
        }

        /* ä¸»å®¹å™¨ */
        .container {
            position: relative;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        /* æ ‡é¢˜ */
        .title {
            color: white;
            font-size: 3rem;
            font-weight: 300;
            margin-bottom: 2rem;
            text-align: center;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        /* æé—®æ¡†å®¹å™¨ */
        .question-container {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.5);
            width: 100%;
            max-width: 600px;
            margin-bottom: 2rem;
        }

        .question-input {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1.1rem;
            margin-bottom: 1rem;
            transition: border-color 0.3s ease;
            outline: none;
        }

        .question-input:focus {
            border-color: #667eea;
        }

        .button-group {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .btn {
            padding: 0.8rem 2rem;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #495057;
            border: 2px solid #e0e0e0;
        }

        .btn-secondary:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* ç»“æœæ˜¾ç¤ºåŒºåŸŸ */
        .result-container {
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(25px) saturate(180%);
            -webkit-backdrop-filter: blur(25px) saturate(180%);
            border-radius: 25px;
            padding: 2.5rem;
            box-shadow: 0 25px 70px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.6);
            text-align: center;
            opacity: 0;
            transform: translateY(30px) scale(0.95);
            transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            max-width: 700px;
            width: 100%;
        }

        .result-container.show {
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        /* å¦è±¡å±•ç¤ºåŒº */
        .hexagram-display {
            display: flex;
            align-items: center;
            gap: 2rem;
            margin-bottom: 2rem;
            padding-bottom: 2rem;
            border-bottom: 2px solid rgba(102, 126, 234, 0.1);
        }

        .hexagram-image {
            width: 140px;
            height: 140px;
            flex-shrink: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 5rem;
            color: white;
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.3);
            animation: hexagramGlow 2s ease-in-out infinite;
        }

        @keyframes hexagramGlow {
            0%, 100% { box-shadow: 0 15px 35px rgba(102, 126, 234, 0.3); }
            50% { box-shadow: 0 15px 45px rgba(102, 126, 234, 0.5); }
        }

        .hexagram-info {
            flex: 1;
            text-align: left;
        }

        .hexagram-name {
            font-size: 1.8rem;
            font-weight: 700;
            color: #495057;
            margin-bottom: 0.8rem;
            line-height: 1.3;
        }

        .hexagram-description {
            color: #6c757d;
            font-size: 1rem;
            line-height: 1.6;
            padding: 0.8rem 1rem;
            background: rgba(102, 126, 234, 0.05);
            border-radius: 10px;
            border-left: 3px solid #667eea;
        }

        /* AIè§£å¦ç»“æœ */
        .ai-interpretation {
            text-align: left;
        }

        .ai-interpretation-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.6rem;
        }

        .ai-interpretation-title::before {
            content: '';
            width: 4px;
            height: 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 2px;
        }

        .ai-interpretation-content {
            color: #495057;
            font-size: 1rem;
            line-height: 1.9;
            white-space: pre-wrap;
            padding: 1.2rem;
            background: rgba(248, 249, 250, 0.8);
            border-radius: 15px;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .ai-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.8rem;
            color: #667eea;
            font-size: 1rem;
            padding: 2rem;
        }

        .loading-spinner {
            width: 24px;
            height: 24px;
            border: 3px solid rgba(102, 126, 234, 0.2);
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .ai-loading::after {
            content: 'æ­£åœ¨ä¸ºæ‚¨è§£å¦...';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 33% { content: 'æ­£åœ¨ä¸ºæ‚¨è§£å¦.'; }
            34%, 66% { content: 'æ­£åœ¨ä¸ºæ‚¨è§£å¦..'; }
            67%, 100% { content: 'æ­£åœ¨ä¸ºæ‚¨è§£å¦...'; }
        }


        /* è¯­éŸ³è¾“å…¥çŠ¶æ€ */
        .voice-recording {
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .title {
                font-size: 2rem;
            }
            
            .question-container {
                padding: 1.5rem;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }

            .result-container {
                padding: 1.5rem;
            }

            .hexagram-display {
                flex-direction: column;
                gap: 1.5rem;
                text-align: center;
            }

            .hexagram-image {
                width: 120px;
                height: 120px;
                font-size: 4rem;
            }

            .hexagram-info {
                text-align: center;
            }

            .hexagram-name {
                font-size: 1.5rem;
            }

            .hexagram-description {
                font-size: 0.9rem;
            }

            .ai-interpretation-content {
                font-size: 0.95rem;
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- 64å¦èƒŒæ™¯ -->
    <div class="hexagram-background" id="hexagramBackground"></div>

    <!-- ä¸»å®¹å™¨ -->
    <div class="container">
        <h1 class="title">æ˜“ç»ç®—å¦</h1>
        
        <!-- æé—®æ¡† -->
        <div class="question-container">
            <input type="text" id="questionInput" class="question-input" placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜...">
            <div class="button-group">
                <button id="voiceBtn" class="btn btn-secondary">
                    <span>ğŸ¤</span>
                    <span id="voiceText">è¯­éŸ³è¾“å…¥</span>
                </button>
                <button id="sendBtn" class="btn btn-primary">
                    <span>ğŸ”®</span>
                    <span>å¼€å§‹ç®—å¦</span>
                </button>
            </div>
        </div>

        <!-- ç»“æœæ˜¾ç¤º -->
        <div class="result-container" id="resultContainer">
            <div class="hexagram-display">
                <div class="hexagram-image" id="hexagramImage"></div>
                <div class="hexagram-info">
                    <div class="hexagram-name" id="hexagramName"></div>
                    <div class="hexagram-description" id="hexagramDescription"></div>
                </div>
            </div>
            <div class="ai-interpretation">
                <div class="ai-interpretation-title">AIè§£å¦</div>
                <div class="ai-interpretation-content" id="aiInterpretationContent"></div>
            </div>
        </div>
    </div>

    <script>
        // 64å¦æ•°æ® - æ ¹æ®å‘¨æ˜“å…­åå››å¦åˆ—è¡¨
        // å¦è±¡ä½¿ç”¨å…­çˆ»è¡¨ç¤ºæ³•ï¼šâ˜°ä¹¾(å¤©) â˜·å¤(åœ°) â˜µå(æ°´) â˜²ç¦»(ç«) â˜³éœ‡(é›·) â˜´å·½(é£) â˜¶è‰®(å±±) â˜±å…‘(æ³½)
        const hexagrams = [
            // ä¸Šç»30å¦
            { name: 'ä¹¾', fullName: 'ä¹¾ä¸ºå¤©', symbol: 'ä·€', lines: 'â˜°â˜°', description: 'å…ƒäº¨åˆ©è²' },
            { name: 'å¤', fullName: 'å¤ä¸ºåœ°', symbol: 'ä·', lines: 'â˜·â˜·', description: 'å…ƒäº¨ï¼Œåˆ©ç‰é¦¬ä¹‹è²' },
            { name: 'å±¯', fullName: 'æ°´é›·å±¯', symbol: 'ä·‚', lines: 'â˜µâ˜³', description: 'å…ƒäº¨åˆ©è²ï¼Œå‹¿ç”¨æœ‰æ”¸å¾€' },
            { name: 'è’™', fullName: 'å±±æ°´è’™', symbol: 'ä·ƒ', lines: 'â˜¶â˜µ', description: 'äº¨ï¼ŒåŒªæˆ‘æ±‚ç«¥è’™ï¼Œç«¥è’™æ±‚æˆ‘' },
            { name: 'éœ€', fullName: 'æ°´å¤©éœ€', symbol: 'ä·„', lines: 'â˜µâ˜°', description: 'æœ‰å­šï¼Œå…‰äº¨è²å‰' },
            { name: 'è®¼', fullName: 'å¤©æ°´è®¼', symbol: 'ä·…', lines: 'â˜°â˜µ', description: 'æœ‰å­šï¼Œçª’æƒ•ï¼Œä¸­å‰ï¼Œçµ‚å‡¶' },
            { name: 'å¸ˆ', fullName: 'åœ°æ°´å¸ˆ', symbol: 'ä·†', lines: 'â˜·â˜µ', description: 'è²ä¸ˆäººå‰ï¼Œæ— å’' },
            { name: 'æ¯”', fullName: 'æ°´åœ°æ¯”', symbol: 'ä·‡', lines: 'â˜µâ˜·', description: 'å‰ï¼ŒåŸç­®ï¼Œå…ƒæ°¸è²ï¼Œæ— å’' },
            { name: 'å°ç•œ', fullName: 'é£å¤©å°ç•œ', symbol: 'ä·ˆ', lines: 'â˜´â˜°', description: 'äº¨ï¼Œå¯†é›²ä¸é›¨ï¼Œè‡ªæˆ‘è¥¿éƒŠ' },
            { name: 'å±¥', fullName: 'å¤©æ³½å±¥', symbol: 'ä·‰', lines: 'â˜°â˜±', description: 'å±¥è™å°¾ï¼Œä¸å’¥äººï¼Œäº¨' },
            { name: 'æ³°', fullName: 'åœ°å¤©æ³°', symbol: 'ä·Š', lines: 'â˜·â˜°', description: 'å°å¾€å¤§ä¾†ï¼Œå‰äº¨' },
            { name: 'å¦', fullName: 'å¤©åœ°å¦', symbol: 'ä·‹', lines: 'â˜°â˜·', description: 'å¦ä¹‹åŒªäººï¼Œä¸åˆ©å›å­è²' },
            { name: 'åŒäºº', fullName: 'å¤©ç«åŒäºº', symbol: 'ä·Œ', lines: 'â˜°â˜²', description: 'åŒäººäºé‡ï¼Œäº¨' },
            { name: 'å¤§æœ‰', fullName: 'ç«å¤©å¤§æœ‰', symbol: 'ä·', lines: 'â˜²â˜°', description: 'å…ƒäº¨' },
            { name: 'è°¦', fullName: 'åœ°å±±è°¦', symbol: 'ä·', lines: 'â˜·â˜¶', description: 'äº¨ï¼Œå›å­æœ‰çµ‚' },
            { name: 'è±«', fullName: 'é›·åœ°è±«', symbol: 'ä·', lines: 'â˜³â˜·', description: 'åˆ©å»ºä¾¯è¡Œå¸«' },
            { name: 'éš', fullName: 'æ³½é›·éš', symbol: 'ä·', lines: 'â˜±â˜³', description: 'å…ƒäº¨åˆ©è²ï¼Œæ— å’' },
            { name: 'è›Š', fullName: 'å±±é£è›Š', symbol: 'ä·‘', lines: 'â˜¶â˜´', description: 'å…ƒäº¨ï¼Œåˆ©æ¶‰å¤§å·' },
            { name: 'ä¸´', fullName: 'åœ°æ³½ä¸´', symbol: 'ä·’', lines: 'â˜·â˜±', description: 'å…ƒäº¨åˆ©è²ï¼Œè‡³äºå…«æœˆæœ‰å‡¶' },
            { name: 'è§‚', fullName: 'é£åœ°è§‚', symbol: 'ä·“', lines: 'â˜´â˜·', description: 'ç›¥è€Œä¸è–¦ï¼Œæœ‰å­šé¡’è‹¥' },
            { name: 'å™¬å—‘', fullName: 'ç«é›·å™¬å—‘', symbol: 'ä·”', lines: 'â˜²â˜³', description: 'äº¨ï¼Œåˆ©ç”¨ç„' },
            { name: 'è´²', fullName: 'å±±ç«è´²', symbol: 'ä·•', lines: 'â˜¶â˜²', description: 'äº¨ï¼Œå°åˆ©æœ‰æ”¸å¾€' },
            { name: 'å‰¥', fullName: 'å±±åœ°å‰¥', symbol: 'ä·–', lines: 'â˜¶â˜·', description: 'ä¸åˆ©æœ‰æ”¸å¾€' },
            { name: 'å¤', fullName: 'åœ°é›·å¤', symbol: 'ä·—', lines: 'â˜·â˜³', description: 'äº¨ï¼Œå‡ºå…¥æ— ç–¾ï¼Œæœ‹ä¾†æ— å’' },
            { name: 'æ— å¦„', fullName: 'å¤©é›·æ— å¦„', symbol: 'ä·˜', lines: 'â˜°â˜³', description: 'å…ƒäº¨åˆ©è²ï¼Œå…¶åŒªæ­£æœ‰çœš' },
            { name: 'å¤§ç•œ', fullName: 'å±±å¤©å¤§ç•œ', symbol: 'ä·™', lines: 'â˜¶â˜°', description: 'åˆ©è²ï¼Œä¸å®¶é£Ÿå‰' },
            { name: 'é¢', fullName: 'å±±é›·é¢', symbol: 'ä·š', lines: 'â˜¶â˜³', description: 'è²å‰ï¼Œè§€é ¤ï¼Œè‡ªæ±‚å£å¯¦' },
            { name: 'å¤§è¿‡', fullName: 'æ³½é£å¤§è¿‡', symbol: 'ä·›', lines: 'â˜±â˜´', description: 'æ£Ÿæ©ˆï¼Œåˆ©æœ‰æ”¸å¾€ï¼Œäº¨' },
            { name: 'å', fullName: 'åä¸ºæ°´', symbol: 'ä·œ', lines: 'â˜µâ˜µ', description: 'ç¿’åï¼Œæœ‰å­šç¶­å¿ƒäº¨' },
            { name: 'ç¦»', fullName: 'ç¦»ä¸ºç«', symbol: 'ä·', lines: 'â˜²â˜²', description: 'åˆ©è²äº¨ï¼Œç•œç‰ç‰›å‰' },
            // ä¸‹ç»34å¦
            { name: 'å’¸', fullName: 'æ³½å±±å’¸', symbol: 'ä·', lines: 'â˜±â˜¶', description: 'äº¨åˆ©è²ï¼Œå–å¥³å‰' },
            { name: 'æ’', fullName: 'é›·é£æ’', symbol: 'ä·Ÿ', lines: 'â˜³â˜´', description: 'äº¨æ— å’ï¼Œåˆ©è²ï¼Œåˆ©æœ‰æ”¸å¾€' },
            { name: 'é', fullName: 'å¤©å±±é', symbol: 'ä· ', lines: 'â˜°â˜¶', description: 'äº¨ï¼Œå°åˆ©è²' },
            { name: 'å¤§å£®', fullName: 'é›·å¤©å¤§å£®', symbol: 'ä·¡', lines: 'â˜³â˜°', description: 'åˆ©è²' },
            { name: 'æ™‹', fullName: 'ç«åœ°æ™‹', symbol: 'ä·¢', lines: 'â˜²â˜·', description: 'åº·ä¾¯ç”¨éŒ«é¦¬è•ƒåº¶' },
            { name: 'æ˜å¤·', fullName: 'åœ°ç«æ˜å¤·', symbol: 'ä·£', lines: 'â˜·â˜²', description: 'åˆ©è‰±è²' },
            { name: 'å®¶äºº', fullName: 'é£ç«å®¶äºº', symbol: 'ä·¤', lines: 'â˜´â˜²', description: 'åˆ©å¥³è²' },
            { name: 'ç½', fullName: 'ç«æ³½ç½', symbol: 'ä·¥', lines: 'â˜²â˜±', description: 'å°äº‹å‰' },
            { name: 'è¹‡', fullName: 'æ°´å±±è¹‡', symbol: 'ä·¦', lines: 'â˜µâ˜¶', description: 'åˆ©è¥¿å—ï¼Œä¸åˆ©æ±åŒ—' },
            { name: 'è§£', fullName: 'é›·æ°´è§£', symbol: 'ä·§', lines: 'â˜³â˜µ', description: 'åˆ©è¥¿å—ï¼Œæ— æ‰€å¾€ï¼Œå…¶ä¾†å¾©å‰' },
            { name: 'æŸ', fullName: 'å±±æ³½æŸ', symbol: 'ä·¨', lines: 'â˜¶â˜±', description: 'æœ‰å­šï¼Œå…ƒå‰ï¼Œæ— å’' },
            { name: 'ç›Š', fullName: 'é£é›·ç›Š', symbol: 'ä·©', lines: 'â˜´â˜³', description: 'åˆ©æœ‰æ”¸å¾€ï¼Œåˆ©æ¶‰å¤§å·' },
            { name: 'å¤¬', fullName: 'æ³½å¤©å¤¬', symbol: 'ä·ª', lines: 'â˜±â˜°', description: 'æšäºç‹åº­ï¼Œå­šè™Ÿæœ‰å²' },
            { name: 'å§¤', fullName: 'å¤©é£å§¤', symbol: 'ä·«', lines: 'â˜°â˜´', description: 'å¥³å£¯ï¼Œå‹¿ç”¨å–å¥³' },
            { name: 'èƒ', fullName: 'æ³½åœ°èƒ', symbol: 'ä·¬', lines: 'â˜±â˜·', description: 'äº¨ï¼Œç‹å‡æœ‰å»Ÿ' },
            { name: 'å‡', fullName: 'åœ°é£å‡', symbol: 'ä·­', lines: 'â˜·â˜´', description: 'å…ƒäº¨ï¼Œç”¨è¦‹å¤§äºº' },
            { name: 'å›°', fullName: 'æ³½æ°´å›°', symbol: 'ä·®', lines: 'â˜±â˜µ', description: 'äº¨è²ï¼Œå¤§äººå‰ï¼Œæ— å’' },
            { name: 'äº•', fullName: 'æ°´é£äº•', symbol: 'ä·¯', lines: 'â˜µâ˜´', description: 'æ”¹é‚‘ä¸æ”¹äº•ï¼Œæ— å–ªæ— å¾—' },
            { name: 'é©', fullName: 'æ³½ç«é©', symbol: 'ä·°', lines: 'â˜±â˜²', description: 'å·±æ—¥ä¹ƒå­šï¼Œå…ƒäº¨åˆ©è²' },
            { name: 'é¼', fullName: 'ç«é£é¼', symbol: 'ä·±', lines: 'â˜²â˜´', description: 'å…ƒå‰äº¨' },
            { name: 'éœ‡', fullName: 'éœ‡ä¸ºé›·', symbol: 'ä·²', lines: 'â˜³â˜³', description: 'äº¨ï¼Œéœ‡ä¾†è™©è™©' },
            { name: 'è‰®', fullName: 'è‰®ä¸ºå±±', symbol: 'ä·³', lines: 'â˜¶â˜¶', description: 'è‰®å…¶èƒŒï¼Œä¸ç²å…¶èº«' },
            { name: 'æ¸', fullName: 'é£å±±æ¸', symbol: 'ä·´', lines: 'â˜´â˜¶', description: 'å¥³æ­¸å‰ï¼Œåˆ©è²' },
            { name: 'å½’å¦¹', fullName: 'é›·æ³½å½’å¦¹', symbol: 'ä·µ', lines: 'â˜³â˜±', description: 'å¾å‡¶ï¼Œæ— æ”¸åˆ©' },
            { name: 'ä¸°', fullName: 'é›·ç«ä¸°', symbol: 'ä·¶', lines: 'â˜³â˜²', description: 'äº¨ï¼Œç‹å‡ä¹‹' },
            { name: 'æ—…', fullName: 'ç«å±±æ—…', symbol: 'ä··', lines: 'â˜²â˜¶', description: 'å°äº¨ï¼Œæ—…è²å‰' },
            { name: 'å·½', fullName: 'å·½ä¸ºé£', symbol: 'ä·¸', lines: 'â˜´â˜´', description: 'å°äº¨ï¼Œåˆ©æœ‰æ”¸å¾€' },
            { name: 'å…‘', fullName: 'å…‘ä¸ºæ³½', symbol: 'ä·¹', lines: 'â˜±â˜±', description: 'äº¨åˆ©è²' },
            { name: 'æ¶£', fullName: 'é£æ°´æ¶£', symbol: 'ä·º', lines: 'â˜´â˜µ', description: 'äº¨ï¼Œç‹å‡æœ‰å»Ÿ' },
            { name: 'èŠ‚', fullName: 'æ°´æ³½èŠ‚', symbol: 'ä·»', lines: 'â˜µâ˜±', description: 'äº¨ï¼Œè‹¦ç¯€ä¸å¯è²' },
            { name: 'ä¸­å­š', fullName: 'é£æ³½ä¸­å­š', symbol: 'ä·¼', lines: 'â˜´â˜±', description: 'è±šé­šå‰ï¼Œåˆ©æ¶‰å¤§å·' },
            { name: 'å°è¿‡', fullName: 'é›·å±±å°è¿‡', symbol: 'ä·½', lines: 'â˜³â˜¶', description: 'äº¨åˆ©è²ï¼Œå¯å°äº‹' },
            { name: 'æ—¢æµ', fullName: 'æ°´ç«æ—¢æµ', symbol: 'ä·¾', lines: 'â˜µâ˜²', description: 'äº¨å°ï¼Œåˆ©è²' },
            { name: 'æœªæµ', fullName: 'ç«æ°´æœªæµ', symbol: 'ä·¿', lines: 'â˜²â˜µ', description: 'äº¨ï¼Œå°ç‹æ±”æ¿Ÿ' }
        ];

        // DOMå…ƒç´ 
        const questionInput = document.getElementById('questionInput');
        const voiceBtn = document.getElementById('voiceBtn');
        const voiceText = document.getElementById('voiceText');
        const sendBtn = document.getElementById('sendBtn');
        const resultContainer = document.getElementById('resultContainer');
        const hexagramImage = document.getElementById('hexagramImage');
        const hexagramName = document.getElementById('hexagramName');
        const hexagramDescription = document.getElementById('hexagramDescription');
        const hexagramBackground = document.getElementById('hexagramBackground');
        const aiInterpretationContent = document.getElementById('aiInterpretationContent');

        // è¯­éŸ³è¯†åˆ«
        let recognition = null;
        let isRecording = false;

        // APIé…ç½®
        let apiKey = 'sk-jitntevrbtbglohuhxidentnldaxkwvwpcwptlbgchodcbhc';
        let currentQuestion = '';
        let currentHexagram = null;
        let flashingInterval = null;

        // åˆå§‹åŒ–è¯­éŸ³è¯†åˆ«
        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.lang = 'zh-CN';
                recognition.continuous = false;
                recognition.interimResults = false;

                recognition.onstart = function() {
                    isRecording = true;
                    voiceText.textContent = 'æ­£åœ¨å¬...';
                    voiceBtn.classList.add('voice-recording');
                };

                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    questionInput.value = transcript;
                };

                recognition.onend = function() {
                    isRecording = false;
                    voiceText.textContent = 'è¯­éŸ³è¾“å…¥';
                    voiceBtn.classList.remove('voice-recording');
                };

                recognition.onerror = function(event) {
                    console.error('è¯­éŸ³è¯†åˆ«é”™è¯¯:', event.error);
                    isRecording = false;
                    voiceText.textContent = 'è¯­éŸ³è¾“å…¥';
                    voiceBtn.classList.remove('voice-recording');
                };
            } else {
                voiceBtn.style.display = 'none';
            }
        }

        // åˆ›å»º64å¦èƒŒæ™¯ - éšæœºé“ºæ»¡å±å¹•
        function createHexagramBackground() {
            hexagramBackground.innerHTML = '';
            
            // è®¡ç®—å±å¹•å°ºå¯¸
            const screenWidth = window.innerWidth;
            const screenHeight = window.innerHeight;
            
            // è®¡ç®—éœ€è¦çš„å¦è±¡æ•°é‡ï¼ˆé“ºæ»¡å±å¹•ï¼Œå¢åŠ å¯†åº¦ï¼‰
            const itemSize = 80;
            const cols = Math.ceil(screenWidth / itemSize) + 2;
            const rows = Math.ceil(screenHeight / itemSize) + 2;
            const totalItems = cols * rows;
            
            // åˆ›å»ºå¦è±¡æ•°ç»„ï¼Œå¾ªç¯ä½¿ç”¨64å¦ç›´åˆ°é“ºæ»¡å±å¹•
            const hexagramArray = [];
            for (let i = 0; i < totalItems; i++) {
                hexagramArray.push(hexagrams[i % 64]);
            }
            
            // éšæœºæ‰“ä¹±æ•°ç»„
            for (let i = hexagramArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [hexagramArray[i], hexagramArray[j]] = [hexagramArray[j], hexagramArray[i]];
            }
            
            // åˆ›å»ºå¦è±¡å…ƒç´ 
            for (let i = 0; i < totalItems; i++) {
                const hexagramItem = document.createElement('div');
                hexagramItem.className = 'hexagram-item';
                
                // éšæœºä½ç½®ï¼ˆå¸¦ä¸€äº›åç§»è®©å¸ƒå±€ä¸é‚£ä¹ˆè§„åˆ™ï¼‰
                const colIndex = i % cols;
                const rowIndex = Math.floor(i / cols);
                const x = colIndex * itemSize + Math.random() * 30 - 15;
                const y = rowIndex * itemSize + Math.random() * 30 - 15;
                
                hexagramItem.style.left = x + 'px';
                hexagramItem.style.top = y + 'px';
                
                // éšæœºæ—‹è½¬è§’åº¦
                const rotation = Math.random() * 360;
                hexagramItem.style.transform = `rotate(${rotation}deg)`;
                
                // éšæœºé€æ˜åº¦
                const opacity = 0.2 + Math.random() * 0.3;
                hexagramItem.style.opacity = opacity;
                
                // éšæœºå­—ä½“å¤§å°
                const fontSize = 28 + Math.random() * 20;
                hexagramItem.style.fontSize = fontSize + 'px';
                
                // è®¾ç½®å…­çˆ»å¦è±¡ç¬¦å·
                hexagramItem.textContent = hexagramArray[i].symbol;
                // æ·»åŠ æ‚¬åœæç¤ºï¼Œæ˜¾ç¤ºå®Œæ•´å¦å
                hexagramItem.title = `${hexagramArray[i].name}å¦ Â· ${hexagramArray[i].fullName}`;
                
                hexagramBackground.appendChild(hexagramItem);
            }
        }

        // å¼€å§‹èƒŒæ™¯é—ªçƒæ•ˆæœ
        function startFlashing() {
            const items = document.querySelectorAll('.hexagram-item');
            flashingInterval = setInterval(() => {
                // éšæœºé€‰æ‹©ä¸€äº›å¦è¿›è¡Œé—ªçƒ
                items.forEach(item => {
                    if (Math.random() < 0.3) {
                        item.classList.add('flashing');
                    } else {
                        item.classList.remove('flashing');
                    }
                });
            }, 200);
        }

        // åœæ­¢èƒŒæ™¯é—ªçƒæ•ˆæœ
        function stopFlashing() {
            if (flashingInterval) {
                clearInterval(flashingInterval);
                flashingInterval = null;
                const items = document.querySelectorAll('.hexagram-item');
                items.forEach(item => {
                    item.classList.remove('flashing');
                });
            }
        }

        // éšæœºé€‰æ‹©ä¸€ä¸ªå¦è±¡ï¼ˆä¸æ˜¾ç¤ºï¼‰
        function selectRandomHexagram() {
            const randomIndex = Math.floor(Math.random() * hexagrams.length);
            return hexagrams[randomIndex];
        }

        // æ˜¾ç¤ºå¦è±¡å’ŒAIè§£å¦ç»“æœ
        function showResult(hexagram, aiResult) {
            // åœæ­¢èƒŒæ™¯é—ªçƒ
            stopFlashing();
            
            // å¡«å……å¦è±¡ä¿¡æ¯
            hexagramImage.textContent = hexagram.symbol;
            hexagramName.textContent = `${hexagram.name}å¦ Â· ${hexagram.fullName}`;
            hexagramDescription.textContent = hexagram.description;
            
            // å¡«å……AIè§£å¦ç»“æœ
            aiInterpretationContent.textContent = aiResult;
            
            // æ˜¾ç¤ºç»“æœå®¹å™¨
            resultContainer.classList.add('show');
            
            // é‡æ–°å¯ç”¨æŒ‰é’®
            sendBtn.disabled = false;
            sendBtn.innerHTML = '<span>ğŸ”®</span><span>å¼€å§‹ç®—å¦</span>';
        }

        // è°ƒç”¨AIè¿›è¡Œè§£å¦
        async function getAIInterpretation(question, hexagram) {
            try {
                const prompt = `ä½ æ˜¯ä¸€ä½ç²¾é€šæ˜“ç»çš„ç®—å¦å¤§å¸ˆã€‚æœ‰äººé—®ï¼š"${question}"ï¼ŒæŠ½åˆ°äº†${hexagram.fullName}ï¼ˆ${hexagram.name}å¦ï¼‰ã€‚

å¦è¾ï¼š${hexagram.description}

è¯·æŒ‰ä»¥ä¸‹ç»“æ„å›ç­”ï¼ˆä¸¥æ ¼æ§åˆ¶åœ¨150å­—ä»¥å†…ï¼‰ï¼š
1. ç¬¬ä¸€æ®µï¼ˆ50å­—å·¦å³ï¼‰ï¼šç”¨é€šä¿—è¯­è¨€è§£é‡Šè¿™ä¸ªå¦çš„æ ¸å¿ƒå«ä¹‰
2. ç¬¬äºŒæ®µï¼ˆ100å­—å·¦å³ï¼‰ï¼šé’ˆå¯¹ç”¨æˆ·çš„é—®é¢˜ç»™å‡ºåˆ†æå’Œå»ºè®®

è¦æ±‚ï¼š
- è¯­è¨€è¦é€šä¿—æ˜“æ‡‚ï¼Œåƒæœ‹å‹èŠå¤©
- ä¸è¦ç”¨"æ ¹æ®å¦è±¡"ç­‰å¥—è¯
- ç›´æ¥ã€å®ç”¨ã€æœ‰é’ˆå¯¹æ€§

ç›´æ¥å¼€å§‹å›ç­”ï¼š`;

                const response = await fetch('https://api.siliconflow.cn/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'Qwen/Qwen3-8B',
                        messages: [
                            {
                                role: 'user',
                                content: prompt
                            }
                        ],
                        temperature: 0.7,
                        max_tokens: 300
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || 'è¯·æ±‚å¤±è´¥');
                }

                const data = await response.json();
                return data.choices[0].message.content;
            } catch (error) {
                console.error('AIè§£å¦é”™è¯¯:', error);
                return `AIè§£å¦é‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼š${error.message}\n\nä¸è¿‡ä¸ç”¨æ‹…å¿ƒï¼Œæ‚¨æŠ½åˆ°çš„"${hexagram.fullName}"æœ¬èº«å°±è•´å«æ·±æ„ã€‚å»ºè®®æ‚¨å¯ä»¥å‚è€ƒå¦è¾ï¼Œç»“åˆè‡ªå·±çš„æƒ…å†µè¿›è¡Œæ€è€ƒã€‚å¦‚éœ€é‡è¯•ï¼Œè¯·åˆ·æ–°é¡µé¢åé‡æ–°ç®—å¦ã€‚`;
            }
        }

        // é‡ç½®ç»“æœ
        function resetResult() {
            resultContainer.classList.remove('show');
            aiInterpretationContent.textContent = '';
            hexagramImage.textContent = '';
            hexagramName.textContent = '';
            hexagramDescription.textContent = '';
        }

        // äº‹ä»¶ç›‘å¬
        voiceBtn.addEventListener('click', function() {
            if (!recognition) return;
            
            if (isRecording) {
                recognition.stop();
            } else {
                recognition.start();
            }
        });

        sendBtn.addEventListener('click', async function() {
            const question = questionInput.value.trim();
            if (!question) {
                alert('è¯·è¾“å…¥æ‚¨çš„é—®é¢˜');
                return;
            }

            // ä¿å­˜å½“å‰é—®é¢˜
            currentQuestion = question;

            // ç¦ç”¨æŒ‰é’®
            sendBtn.disabled = true;
            sendBtn.innerHTML = '<span>ğŸ”®</span><span>AIè§£å¦ä¸­...</span>';

            // é‡ç½®ç»“æœ
            resetResult();

            // ç«‹å³éšæœºé€‰æ‹©ä¸€ä¸ªå¦è±¡ï¼ˆä¸æ˜¾ç¤ºï¼‰
            const selectedHexagram = selectRandomHexagram();
            currentHexagram = selectedHexagram;

            // å¼€å§‹èƒŒæ™¯é—ªçƒåŠ¨ç”»
            startFlashing();

            // åœ¨AIè§£å¦å†…å®¹åŒºåŸŸæ˜¾ç¤ºåŠ è½½åŠ¨ç”»ï¼ˆæå‰å‡†å¤‡ç»“æœå®¹å™¨ä½†ä¸æ˜¾ç¤ºï¼‰
            aiInterpretationContent.innerHTML = '<div class="ai-loading"><div class="loading-spinner"></div></div>';

            // è°ƒç”¨AIè¿›è¡Œè§£å¦ï¼ˆå¼‚æ­¥ï¼Œç­‰å¾…ç»“æœï¼‰
            const aiResult = await getAIInterpretation(question, selectedHexagram);

            // AIå®Œæˆåï¼Œæ˜¾ç¤ºå¦è±¡å’Œè§£å¦ç»“æœ
            showResult(selectedHexagram, aiResult);
        });

        // å›è½¦é”®å‘é€
        questionInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendBtn.click();
            }
        });

        // çª—å£å¤§å°å˜åŒ–æ—¶é‡æ–°å¸ƒå±€
        window.addEventListener('resize', function() {
            createHexagramBackground();
        });

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initSpeechRecognition();
            createHexagramBackground();
        });
    </script>
</body>
</html>
